# æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨è¯´æ˜

## æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ **OpenDAL æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨** æ¥ç®¡ç†è®ºæ–‡æ•°æ®ï¼Œè¿™ä¸ºåç»­æ‰©å±•åˆ°äº‘å­˜å‚¨æä¾›äº†çµæ´»çš„æ¶æ„ï¼ŒåŒæ—¶ä¿æŒå½“å‰çš„ç®€å•æ€§ã€‚

## è®¾è®¡ç†å¿µ

### ä¸ºä»€ä¹ˆä½¿ç”¨ OpenDAL æ–‡ä»¶ç³»ç»Ÿï¼Ÿ

1. **ç»Ÿä¸€æ¥å£**: OpenDAL æä¾›ç»Ÿä¸€çš„å­˜å‚¨æŠ½è±¡å±‚ï¼Œæ— è®ºæ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè¿˜æ˜¯äº‘å­˜å‚¨ï¼Œéƒ½ä½¿ç”¨ç›¸åŒçš„ API
2. **ä¾¿äºå‡çº§**: å½“éœ€è¦è¿ç§»åˆ°äº‘å­˜å‚¨æ—¶ï¼Œåªéœ€ä¿®æ”¹é…ç½®ï¼Œæ— éœ€æ”¹åŠ¨ä»£ç é€»è¾‘
3. **é›¶å­¦ä¹ æˆæœ¬**: å¯¹ç”¨æˆ·æ¥è¯´ï¼Œé»˜è®¤é…ç½®ä¸‹å°±åƒä½¿ç”¨æ™®é€šæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ç®€å•
4. **æ€§èƒ½ä¼˜åŒ–**: OpenDAL é’ˆå¯¹å„ç§å­˜å‚¨åç«¯è¿›è¡Œäº†ä¼˜åŒ–

### å½“å‰å®ç°

- é»˜è®¤ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆ`fs` schemeï¼‰
- æ•°æ®å­˜å‚¨åœ¨ `data/` ç›®å½•
- å¯é€‰é…ç½®å½’æ¡£ç›®å½•ç”¨äºæœˆåº¦åˆå¹¶æ–‡ä»¶

## é…ç½®æ–¹å¼

### åŸºæœ¬é…ç½®ï¼ˆæ— å½’æ¡£ï¼‰

```python
from storage import PaperStorage

# æœ€ç®€å•çš„æ–¹å¼ï¼Œæ‰€æœ‰æ•°æ®éƒ½åœ¨ data/ ç›®å½•
storage = PaperStorage(local_data_dir="data")
```

### é…ç½®å½’æ¡£ç›®å½•

```python
# åˆ†ç¦»æ¯æ—¥æ•°æ®å’Œå½’æ¡£æ•°æ®
storage = PaperStorage(
    local_data_dir="data",      # æ¯æ—¥æ•°æ®
    archive_dir="/backup/papers"  # æœˆåº¦å½’æ¡£
)
```

### ä»ç¯å¢ƒå˜é‡åŠ è½½

```bash
# .env æ–‡ä»¶
ARCHIVE_DIR=/backup/papers
```

```python
# Python ä»£ç 
storage = PaperStorage.from_env(local_data_dir="data")
```

## ç›®å½•ç»“æ„

### æ¯æ—¥æ•°æ®

```
data/
â”œâ”€â”€ 2025/
â”‚   â”œâ”€â”€ 10/
â”‚   â”‚   â”œâ”€â”€ papers_2025-10-01.parquet
â”‚   â”‚   â”œâ”€â”€ papers_2025-10-02.parquet
â”‚   â”‚   â””â”€â”€ papers_2025-10-03.parquet
â”‚   â””â”€â”€ 11/
â”‚       â””â”€â”€ papers_2025-11-01.parquet
```

### æœˆåº¦å½’æ¡£

å¦‚æœé…ç½®äº† `ARCHIVE_DIR`ï¼š

```
/backup/papers/
â”œâ”€â”€ 2025/
â”‚   â”œâ”€â”€ papers_2025-10_merged.parquet
â”‚   â””â”€â”€ papers_2025-11_merged.parquet
```

## OpenDAL ä½¿ç”¨ç¤ºä¾‹

```python
# å†™å…¥æ–‡ä»¶
storage.operator.write("test.txt", b"Hello World")

# è¯»å–æ–‡ä»¶
content = storage.operator.read("test.txt")

# åˆ é™¤æ–‡ä»¶
storage.operator.delete("test.txt")

# åˆ—å‡ºç›®å½•
entries = storage.operator.list("2025/")
```

## åç»­æ‰©å±•

å¦‚æœå°†æ¥éœ€è¦æ”¯æŒäº‘å­˜å‚¨ï¼ˆS3ã€Azureã€GCS ç­‰ï¼‰ï¼Œåªéœ€ï¼š

1. æ›´æ–° `__init__` æ–¹æ³•æ¥å—å­˜å‚¨é…ç½®
2. ä¿®æ”¹ OpenDAL åˆå§‹åŒ–å‚æ•°
3. ç”¨æˆ·ç«¯åªéœ€æ”¹é…ç½®ï¼Œä»£ç æ— éœ€å˜åŠ¨

### æ‰©å±•ç¤ºä¾‹ï¼ˆæœªæ¥ï¼‰

```python
# S3 å­˜å‚¨ï¼ˆæœªæ¥å¯èƒ½çš„å®ç°ï¼‰
storage = PaperStorage(
    local_data_dir="data",
    storage_scheme="s3",
    storage_config={
        "bucket": "my-papers",
        "region": "us-east-1",
        "access_key_id": "xxx",
        "secret_access_key": "xxx"
    }
)
```

## ç‰¹ç‚¹

### âœ… å½“å‰ä¼˜åŠ¿

- **ç®€å•**: é»˜è®¤é…ç½®æ— éœ€ä»»ä½•äº‘æœåŠ¡
- **çµæ´»**: æ”¯æŒè‡ªå®šä¹‰å½’æ¡£ç›®å½•
- **å¯é **: ä½¿ç”¨æˆç†Ÿçš„ Parquet æ ¼å¼
- **é«˜æ•ˆ**: Snappy å‹ç¼©ï¼ŒèŠ‚çœç©ºé—´

### ğŸš€ æœªæ¥æ‰©å±•æ€§

- æ— ç¼åˆ‡æ¢åˆ°äº‘å­˜å‚¨
- æ”¯æŒå¤šç§äº‘æœåŠ¡å•†
- ç»Ÿä¸€çš„å­˜å‚¨æ¥å£
- ä¾¿äºè¿ç§»å’Œå¤‡ä»½

## æµ‹è¯•

è¿è¡Œå­˜å‚¨æµ‹è¯•ï¼š

```bash
uv run python tests/test_fs_storage.py
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… æœ¬åœ°å­˜å‚¨åˆå§‹åŒ–
- âœ… å½’æ¡£ç›®å½•é…ç½®
- âœ… ç¯å¢ƒå˜é‡åŠ è½½
- âœ… OpenDAL è¯»å†™æ“ä½œ
- âœ… å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯

## ç›¸å…³æ–‡æ¡£

- [ç¼“å­˜å’Œå­˜å‚¨é›†æˆ](CACHE_STORAGE.md)
- [å­˜å‚¨å®ç°æ€»ç»“](IMPLEMENTATION_SUMMARY.md)
- [OpenDAL å®˜æ–¹æ–‡æ¡£](https://opendal.apache.org/)
